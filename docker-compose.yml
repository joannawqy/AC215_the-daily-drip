version: "3.9"

x-shared-volumes: &shared-volumes
  - ./dailydrip_rag/data:/app/data
  - ./dailydrip_rag/indexes:/app/indexes
  - ./dailydrip_rag:/app/dailydrip_rag
  - ./agent_core:/app/agent_core

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile.monolith
    ports:
      - "80:80" # Frontend
      - "8000:8000" # RAG (Debug)
      - "9000:9000" # Agent (Debug)
    environment:
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      # RAG_PERSIST_DIR and RAG_SERVICE_URL are set in supervisord.conf or Dockerfile
      # but we can override here if needed.
    volumes: *shared-volumes
