FROM python:3.11-slim

ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

RUN apt-get update && apt-get install -y --no-install-recommends build-essential curl && rm -rf /var/lib/apt/lists/*
ENV PATH="/root/.local/bin:${PATH}"
RUN curl -LsSf https://astral.sh/uv/install.sh | sh

WORKDIR /app

COPY agent.py bean.json coffee_brew_logs.jsonl ./
COPY visualization_agent_v2.py ./visualization_agent_v2.py
COPY dailydrip_rag ./dailydrip_rag
COPY agent_requirements.txt ./

RUN uv venv /opt/agent-venv && \
    . /opt/agent-venv/bin/activate && \
    uv pip install --no-cache-dir -r agent_requirements.txt
ENV PATH="/opt/agent-venv/bin:${PATH}"

CMD ["uvicorn", "agent:app", "--host", "0.0.0.0", "--port", "9000"]
